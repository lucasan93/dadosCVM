---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# dadosCVM

<!-- badges: start -->
<!-- badges: end -->

The goal of dadosCVM is to obtain and adjust data of investments funds registered on Comissão de Valores Mobiliários (Security and Exchange Commissions from Brazil). Data is collected from files available at http://dados.cvm.gov.br/dados/. 

Main goals/ideas are descripted below:

  - cad_fi(): Download the latest Registration Data ('Dados Cadastrais') available on CVM at http://dados.cvm.gov.br/dados/FI/CAD/DADOS/ - 100%;
  - dados_diarios(): Download the daily fund information (CNPJ, fund raisings and withdraws, investors' amount, equity value, share value) of selected funds between two dates. Data is available at http://dados.cvm.gov.br/dados/FI/DOC/INF_DIARIO/DADOS/ - under development;
  - fidc(): Develop a function that downloads monthly FIDC data between two dates from a selected table of the FIDC files located at http://dados.cvm.gov.br/dados/FIDC/DOC/INF_MENSAL/DADOS/ - 0%;
  - simpl_names(): Develop a function that simplifies funds names (i.e. transforms 'FUNDO DE INVESTIMENTO EM DIREITOS CREDITORIOS' to 'FIDC') - 0%.

## Installation

You can install the development version of dadosCVM from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("lucasan93/dadosCVM")
```

## Examples

### 1: Downloading the latest registration data from CVM:

The function _cad_fi()_ downloads the latest registration data available on CVM.

```{r example, warning=FALSE, message=FALSE}
library(dadosCVM)
library(dplyr)
library(kableExtra)
```

Below the top-10 funds in operation are extracted, sorted by their equity and identified by their CNPJ (Brazil National Registry of Legal Entities number). Note that the _data.frame_ contains 40 columns and more than 60 thousand observations. 

```{r cadfi, warning=FALSE, message=FALSE}
dados_cadastrais <- cad_fi() %>%
                      filter(situacao == 'EM FUNCIONAMENTO NORMAL') %>% 
                      select(cnpj,
                             classe,
                             tipo,
                             inicio_atv,
                             pl_data,
                             pl) %>% 
                      arrange(desc(pl)) %>% 
                      slice_head(n = 10) %>% 
                      mutate(pl = format(pl, big.mark = ','))

kable(dados_cadastrais)
```

### 2: Obtaining daily data 

The function _dados_diarios()_ downloads daily data (CNPJ, portfolio value, share value, equity, withdraws, fund raisings, and number of investors) for a specific fund (identified by its CNPJ) between two given dates. Note that daily data is only available for funds of type 'FI' and that initial date must be greater than 2005-01-01.

```{r example2, warning=FALSE, message=FALSE}
library(dadosCVM)
library(dplyr)
library(ggplot2)
library(scales)
```

Below we obtain data from funds displayed in the previous example and plot their equity value over time:

```{r}
dados_diarios(cnpj  = dados_cadastrais$cnpj,
              start = as.Date('2005-01-01'),
              end   = as.Date('2022-03-01')) %>% 
      select(data, cnpj, pl) %>% 
      ggplot() +
      aes(x = data, y = pl, color = cnpj) +
      geom_line() +
      scale_y_continuous(labels = unit_format(unit = "Bi", scale = 1e-9)) +
      xlab('Date') +
      ylab('Equity (BRL)') +
      theme_minimal()
```



